## GoogleのSpeed Hackathonに<br>参加してきました
+++
そのコンセプトはシンプル！
+++
> とにかくパフォーマンスのいいサイトにしましょう。
> もうなんでもいいです。
> なんでもいいから、表示が速くて画面遷移がスムーズなものにしてユーザーに好かれましょう。
+++
<div style="vertical-align: middle;">
  <img src="assets/images/mario.png" width="100px" height="auto" style="border:none; margin: 0 40px;">
  👉
  <img src="assets/images/mario.gif" width="200px" height="auto" style="border:none; margin: 0 40px;">
</div>

+++
### なんで高速化にそんなにこだわるの？

+++
それは様々な調査で

> - 53%の訪問者はページの表示が3秒遅れるだけで離脱する
> - 1秒表示が遅れるごとに20%ものコンバージョン率が減る

という結果が出ているから

+++
3秒で表示されていたページが1 秒で表示されれば、

- __離脱率の53%を抑え、__
- __40%のコンバージョン率を改善__

ということになりますね😎

+++
(；´Д｀)
 多様なデバイス・あらゆる環境での__モバイルWebにおいて__
 ページスピードは非常に重要になってきている

+++
ここで理解してほしいのは、
__スピード改善できればAMPじゃなくてもOK__
ということ。
+++
## そう、なんでもいいから早くしろ！

+++
## じゃ、AMPじゃなくてもいい？いや、AMPすげぇ
+++
## AMPってなに？
爆速なWebサイトを作る為のフレームワーク
+++
### なんで早くなるの？
+++
- 基本的にJavascriptは使わせない！
- AMPが用意するWeb Componentsを利用する
+++
ページロードを阻害する要素をそもそも使わせないルール
このルールに則ることで、重い挙動の原因となるものがない状態になる
+++

- Validatorをパスするページは __Google AMP Cache__ を利用できる

+++
googleのCDNキャッシュを使えるようになる

+++
### こんな良さもあります
- Google Search経由のアクセスは最速
- 検索結果カルーセル部分に記事コンテンツが表示
- ResponsiveなサイトもOK
- 実はDynamicなサイト（ECとか）もOK

+++
## スピード比較
実装してみました。
そのスピード比較をしましょう

+++
- [これまでのLP](http://develop.ca-test-dhc.com/shop/ad/sph/idenshi/adv/index_n_basaj.html) ↗️
- [AMP](http://develop.ca-test-dhc.com/shop/ad/sph/idenshi/adv/index_amp.html) ↗️
- [SPD](http://develop.ca-test-dhc.com/shop/ad/sph/idenshi/adv/index_spd.html) ↗️
+++
パフォーマンス計測
- Lighthouse
- [WebPagetest](https://www.webpagetest.org/) ↗️


+++
## 解説
+++
### AMP
Ampの仕様に則ってコードを書き換えてみました。

残念なことに開発環境ではベーシック認証がかかっているため、
ロードスピード爆速化の要である、CDNを利用できていません。
+++
ただ、それでもこのパフォーマンスです。( ｰ`дｰ´)ｷﾘｯ
つまり、 __仕様に準拠するだけでスピード改善__しているということです。
+++
(；´∀｀)
また、そもそもなんですが、DHCの場合はサーバーの文字コードがshift-jisなので仕様から外れます。

+++
### Speed hack
AMPではない方法で、可能な限りチューニングを施します。
とはいえ、基本は同じ考えでOKです。

+++
- 文字コードのUTF-8化
- 画像のファイルサイズを軽量化
- canonicalの設定


+++
## AMP実装ってかんたん？
実は、みなさんが思っているよりも、簡単です。
よって、「既存の環境で 無事に動作させられるかどうか」がハードルになります
実装そのものよりも、腐心することになるでしょう。

+++
AMPに対応するためには、サイトに対して以下の項目をクリアにする必要があります。
- html tagを、amp tagに書き換える必要がある
- 既存のjsが使えなくなる
- AMP対応以降、AMPに準拠し続けなくてはならない（メンテナンス性）

+++
サイトの仕様そのものが大きく変わります。
既存のシステムから移行しようとすると、影響が大きいです。
特に、クライアントの環境には注意をしましょう
場合によっては大きなトラブルに繋がりかねないので、開発にはクライアントの深い理解が不可欠です。

+++
### AMPによる副作用
- 自身􏰀のコンテンツが 3rd partyとして扱われる悪影響
- AMPページ􏰁は場合によって別ドメインでコンテンツが配信される
- 従ってオリジンやドメインを意識する機能が動作しない可能性がある
- 3rd Party Cookieブロッキングブラウザで􏰁Cookie􏰀書込が出来ない
- 表示されているページで􏰁Service Worker􏰁動作しない
- Web App Manifestによるホーム画面へ追加が動作しない
- 上記を克服する意味でOrigin AMPという選択肢もある

+++
## 結論
+++
- 必ずしもAMPだけが正解ではない
- モバイル・デバイスでの高速表示は今後、最低ラインの基準となる
- よりコンテンツの質が問われるようになっていく
+++

どうしても「AMPを使いたい」、「AMPを使うから意味がある」という場合は、
UTF-8のサーバーを用意してもらい、その他、障壁となる問題を解決することで導入は可能です。
+++
## すべてはユーザー体験の向上のために
+++
上記をチューニングしたら、よりよい体験をユーザーに提供しましょう。

### PWAについて
- Webアプリを __ホーム画面に追加__ できるようになったり、
- __オフラインでも動作__するようになったり
- __プッシュ通知__ができるようになったり。

そんな今までWebでは実現できなかったアプリっぽいことができるようになります。
